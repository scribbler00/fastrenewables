---

title: tabular.core


keywords: fastai
sidebar: home_sidebar

summary: "API details."
description: "API details."
nb_path: "nbs/01_tabular.core.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01_tabular.core.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/home/scribbler/anaconda/lib/python3.8/site-packages/torch/cuda/__init__.py:52: UserWarning: CUDA initialization: Unexpected error from cudaGetDeviceCount(). Did you run some cuda functions before calling NumCudaDevices() that might have already set an error? Error 804: forward compatibility was attempted on non supported HW (Triggered internally at  /pytorch/c10/cuda/CUDAFunctions.cpp:109.)
  return torch._C._cuda_getDeviceCount() &gt; 0
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Helpers-to-read-files.">Helpers to read files.<a class="anchor-link" href="#Helpers-to-read-files."> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_hdf" class="doc_header"><code>read_hdf</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L37" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_hdf</code>(<strong><code>file</code></strong>:<code>PosixPath</code>, <strong><code>key</code></strong>:<code>str</code>=<em><code>'/powerdata'</code></em>, <strong><code>key_metadata</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Reads a hdf5 table based on the given key.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_csv" class="doc_header"><code>read_csv</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L52" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_csv</code>(<strong><code>file</code></strong>:<code>PosixPath</code>, <strong><code>sep</code></strong>:<code>str</code>=<em><code>';'</code></em>)</p>
</blockquote>
<p>Reads a csv file.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_files" class="doc_header"><code>read_files</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L60" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_files</code>(<strong><code>files</code></strong>:<code>PosixPath</code>, <strong><code>key</code></strong>:<code>str</code>=<em><code>'/powerdata'</code></em>, <strong><code>key_metadata</code></strong>=<em><code>None</code></em>, <strong><code>sep</code></strong>:<code>str</code>=<em><code>';'</code></em>, <strong><code>add_task_id</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>Reads a number of CSV or HDF5 files depending on file ending.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]},</span>
                  <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="s1">&#39;data.h5&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;df&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">read_files</span><span class="p">(</span><span class="s2">&quot;data.h5&quot;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;df&quot;</span><span class="p">,</span> <span class="n">add_task_id</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]},)</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;data.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">read_files</span><span class="p">(</span><span class="s2">&quot;data.csv&quot;</span><span class="p">,</span> <span class="n">add_task_id</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Feature-Engineering">Feature Engineering<a class="anchor-link" href="#Feature-Engineering"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="RenewablesTabularProc" class="doc_header"><code>class</code> <code>RenewablesTabularProc</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L90" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>RenewablesTabularProc</code>(<strong><code>enc</code></strong>=<em><code>None</code></em>, <strong><code>dec</code></strong>=<em><code>None</code></em>, <strong><code>split_idx</code></strong>=<em><code>None</code></em>, <strong><code>order</code></strong>=<em><code>None</code></em>) :: <code>TabularProc</code></p>
</blockquote>
<p>Base class to differentiate between fastai and fastrenewables pre-processing functionality.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">TestProc</span><span class="p">(</span><span class="n">RenewablesTabularProc</span><span class="p">):</span> <span class="k">pass</span>
<span class="n">test_eq</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">TestProc</span><span class="p">(),</span> <span class="n">RenewablesTabularProc</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CreateTimeStampIndex" class="doc_header"><code>class</code> <code>CreateTimeStampIndex</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L133" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CreateTimeStampIndex</code>(<strong><code>index_col_name</code></strong>, <strong><code>offset_correction</code></strong>=<em><code>None</code></em>, <strong><code>group_by_col</code></strong>=<em><code>'TaskID'</code></em>) :: <a href="/fastrenewables/tabular.core.html#RenewablesTabularProc"><code>RenewablesTabularProc</code></a></p>
</blockquote>
<p>Assures a correct pandas timestamp.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_test_data</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;TimeStamps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
    <span class="k">return</span> <span class="n">TabularPandas</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="c1"># tests basic functionality to set a proper timestamp based index</span>
<span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2015-01-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-01-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-01-02-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-02-01-23&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-02-01-13&#39;</span><span class="p">]</span> 
<span class="n">to</span> <span class="o">=</span> <span class="n">get_test_data</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">CreateTimeStampIndex</span><span class="p">(</span><span class="n">index_col_name</span><span class="o">=</span><span class="s2">&quot;TimeStamps&quot;</span><span class="p">)(</span><span class="n">to</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="c1"># corrects missing year</span>
<span class="n">index_missing_year</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0000-01-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;0000-01-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;0000-01-02-03&#39;</span><span class="p">,</span> <span class="s1">&#39;0000-02-01-23&#39;</span><span class="p">,</span> <span class="s1">&#39;0000-02-01-13&#39;</span><span class="p">]</span> 
<span class="n">to</span> <span class="o">=</span> <span class="n">get_test_data</span><span class="p">(</span><span class="n">index_missing_year</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">CreateTimeStampIndex</span><span class="p">(</span><span class="n">index_col_name</span><span class="o">=</span><span class="s2">&quot;TimeStamps&quot;</span><span class="p">)(</span><span class="n">to</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="c1"># check if warning is triggered, due to wrong column name</span>
<span class="n">to</span> <span class="o">=</span> <span class="n">get_test_data</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
<span class="n">test_call</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">CreateTimeStampIndex</span><span class="p">(</span><span class="n">index_col_name</span><span class="o">=</span><span class="s2">&quot;FalseColumnName&quot;</span><span class="p">)(</span><span class="n">to</span><span class="p">)</span>
<span class="n">test_warns</span><span class="p">(</span><span class="n">test_call</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>int</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_samples_per_day" class="doc_header"><code>get_samples_per_day</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L166" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_samples_per_day</code>(<strong><code>df</code></strong>, <strong><code>n_samples_to_check</code></strong>=<em><code>100</code></em>, <strong><code>expected_samples</code></strong>=<em><code>[8, 24, 96]</code></em>)</p>
</blockquote>
<p>Extract the amount of entries per day from the DataFrame in the first n_samples_to_check.
Aborts, ones the first meaningful <em>number of samples per day</em> is found.</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>df : pandas.DataFrame
    the DataFrame used for the conversion.</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h2><p>integer
    amount of entries per day.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_data_samples_per_day</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">index</span><span class="p">),</span>
                      <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">test_data_samples_per_day</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s1">&#39;2018-01-01-00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-01-01-04:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2020-01-01-07:00&#39;</span><span class="p">,]</span> <span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">get_samples_per_day</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">test_data_samples_per_day</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s1">&#39;2018-01-01-00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-01-01-02:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2020-01-01-03:00&#39;</span><span class="p">,]</span> <span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="n">get_samples_per_day</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">test_data_samples_per_day</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s1">&#39;2018-01-01-00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-01-01-01:15&#39;</span><span class="p">,</span> <span class="s1">&#39;2020-01-01-01:30&#39;</span><span class="p">,]</span> <span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="n">get_samples_per_day</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">get_samples_per_day</span><span class="p">(</span><span class="n">test_data_samples_per_day</span><span class="p">([])))</span>
<span class="c1"># assure that duplicated values are considered,e.g., multiple tasks sharing the same indexes</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">test_data_samples_per_day</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s1">&#39;2018-01-01-00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01-01:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01-00:00&#39;</span><span class="p">,</span><span class="s1">&#39;2018-01-01-01:00&#39;</span><span class="p">]</span> <span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="n">get_samples_per_day</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">n_samples_to_check</span><span class="o">=</span><span class="mi">1</span> <span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_data_interpolate</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s1">&#39;2018-01-01-01:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01-02:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01-03:00&#39;</span><span class="p">])):</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">index</span><span class="p">),</span>
                      <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">),</span><span class="mi">3</span><span class="p">)),</span>
                  <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="p">)</span>
    
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">hour</span>
    
    <span class="k">return</span> <span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">test_data_interpolate</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s1">&#39;2018-01-01-01:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01-01:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01-03:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01-04:00&#39;</span><span class="p">]),)</span>
<span class="n">df_interpolated</span> <span class="o">=</span> <span class="n">_interpolate_df</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">drop_na</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>Hour</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-01-01 01:00:00</th>
      <td>8</td>
      <td>8</td>
      <td>6</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2018-01-01 01:00:00</th>
      <td>2</td>
      <td>8</td>
      <td>7</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2018-01-01 03:00:00</th>
      <td>2</td>
      <td>1</td>
      <td>5</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2018-01-01 04:00:00</th>
      <td>4</td>
      <td>4</td>
      <td>5</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_interpolated</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>Hour</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-01-01 01:00:00</th>
      <td>8.00</td>
      <td>8.000</td>
      <td>6.000</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2018-01-01 01:15:00</th>
      <td>7.25</td>
      <td>7.125</td>
      <td>5.875</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2018-01-01 03:00:00</th>
      <td>2.00</td>
      <td>1.000</td>
      <td>5.000</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2018-01-01 03:15:00</th>
      <td>2.50</td>
      <td>1.750</td>
      <td>5.000</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2018-01-01 04:00:00</th>
      <td>4.00</td>
      <td>4.000</td>
      <td>5.000</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Interpolate" class="doc_header"><code>class</code> <code>Interpolate</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L283" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Interpolate</code>(<strong><code>sample_time</code></strong>=<em><code>'15Min'</code></em>, <strong><code>limit</code></strong>=<em><code>5</code></em>, <strong><code>drop_na</code></strong>=<em><code>True</code></em>, <strong><code>group_by_col</code></strong>=<em><code>'TaskID'</code></em>) :: <a href="/fastrenewables/tabular.core.html#RenewablesTabularProc"><code>RenewablesTabularProc</code></a></p>
</blockquote>
<p>Interpolates continous features to required sample time.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">test_data_interpolate</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s1">&#39;2018-01-01-01:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01-02:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01-01:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01-02:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01-03:00&#39;</span><span class="p">]),)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;TaskID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">to</span> <span class="o">=</span> <span class="n">TabularPandas</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">procs</span><span class="o">=</span><span class="n">Interpolate</span><span class="p">,</span> <span class="n">do_setup</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">TaskID</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">TaskID</span><span class="o">==</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">test_data_interpolate</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s1">&#39;2018-01-01-01:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01-02:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01-01:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01-02:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01-03:00&#39;</span><span class="p">]),)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;TaskID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">to</span> <span class="o">=</span> <span class="n">TabularPandas</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">cont_names</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">procs</span><span class="o">=</span><span class="n">Interpolate</span><span class="p">,</span> <span class="n">do_setup</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">B</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">TaskID</span><span class="o">==</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">test_data_interpolate</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s1">&#39;2018-01-01-01:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01-02:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01-01:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01-02:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01-03:00&#39;</span><span class="p">]),)</span>
<span class="n">to</span> <span class="o">=</span> <span class="n">TabularPandas</span><span class="p">(</span><span class="n">df</span><span class="p">,</span>  <span class="n">cont_names</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">procs</span><span class="o">=</span><span class="n">Interpolate</span><span class="p">,</span> <span class="n">do_setup</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">test_data_interpolate</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="p">[])</span>
<span class="n">to</span> <span class="o">=</span> <span class="n">TabularPandas</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">procs</span><span class="o">=</span><span class="n">Interpolate</span><span class="p">,</span> <span class="n">do_setup</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>&lt;ipython-input-31-939a87647e65&gt;:16: UserWarning: Could not determine samples per day. Skip processing.
  warnings.warn(&#34;Could not determine samples per day. Skip processing.&#34;)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;1/1/2018&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;3H&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">test_data_interpolate</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>Hour</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-01-01 15:00:00</th>
      <td>4</td>
      <td>3</td>
      <td>7</td>
      <td>15</td>
    </tr>
    <tr>
      <th>2018-01-01 18:00:00</th>
      <td>6</td>
      <td>1</td>
      <td>3</td>
      <td>18</td>
    </tr>
    <tr>
      <th>2018-01-01 21:00:00</th>
      <td>5</td>
      <td>8</td>
      <td>4</td>
      <td>21</td>
    </tr>
    <tr>
      <th>2018-01-02 00:00:00</th>
      <td>6</td>
      <td>3</td>
      <td>9</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2018-01-02 03:00:00</th>
      <td>2</td>
      <td>0</td>
      <td>4</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">_create_consistent_number_of_sampler_per_day</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">n_samples_per_day</span><span class="o">=</span> <span class="n">get_samples_per_day</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
<span class="c1"># last two rows are removed, as they are not a &quot;complete day&quot;</span>
<span class="n">test_eq</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="FilterInconsistentSamplesPerDay" class="doc_header"><code>class</code> <code>FilterInconsistentSamplesPerDay</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L344" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>FilterInconsistentSamplesPerDay</code>(<strong><code>group_by_col</code></strong>=<em><code>'TaskID'</code></em>) :: <a href="/fastrenewables/tabular.core.html#RenewablesTabularProc"><code>RenewablesTabularProc</code></a></p>
</blockquote>
<p>Filters an incosistent number of samples per day, e.g., when certain timestamps within a day are missing.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">FilterInconsistentSamplesPerDay</span><span class="o">.</span><span class="n">order</span> <span class="o">&gt;</span> <span class="n">Interpolate</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;1/1/2018&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;3H&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">test_data_interpolate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;TaskID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">11</span> <span class="k">else</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))]</span>
<span class="n">to</span>  <span class="o">=</span> <span class="n">TabularPandas</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">procs</span><span class="o">=</span><span class="n">FilterInconsistentSamplesPerDay</span><span class="p">,</span> <span class="n">do_setup</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># equal to two days with eight samples per day</span>
<span class="n">test_eq</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">to</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-01-01 00:00:00</th>
    </tr>
    <tr>
      <th>2018-01-01 03:00:00</th>
    </tr>
    <tr>
      <th>2018-01-01 06:00:00</th>
    </tr>
    <tr>
      <th>2018-01-01 09:00:00</th>
    </tr>
    <tr>
      <th>2018-01-01 12:00:00</th>
    </tr>
    <tr>
      <th>2018-01-01 15:00:00</th>
    </tr>
    <tr>
      <th>2018-01-01 18:00:00</th>
    </tr>
    <tr>
      <th>2018-01-01 21:00:00</th>
    </tr>
    <tr>
      <th>2018-01-03 00:00:00</th>
    </tr>
    <tr>
      <th>2018-01-03 03:00:00</th>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="FilterOutliers" class="doc_header"><code>class</code> <code>FilterOutliers</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L362" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>FilterOutliers</code>(<strong><code>column_names</code></strong>=<em><code>['PowerGeneration']</code></em>, <strong><code>min_values</code></strong>=<em><code>[0]</code></em>, <strong><code>max_values</code></strong>=<em><code>[1.2]</code></em>) :: <a href="/fastrenewables/tabular.core.html#RenewablesTabularProc"><code>RenewablesTabularProc</code></a></p>
</blockquote>
<p>Adds seasonal features, such as month of the year, as continious or categorical feature.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="AddSeasonalFeatures" class="doc_header"><code>class</code> <code>AddSeasonalFeatures</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L385" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>AddSeasonalFeatures</code>(<strong><code>as_cont</code></strong>=<em><code>True</code></em>) :: <a href="/fastrenewables/tabular.core.html#RenewablesTabularProc"><code>RenewablesTabularProc</code></a></p>
</blockquote>
<p>Adds seasonal features, such as month of the year, as continious or categorical feature.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">to</span> <span class="o">=</span> <span class="n">get_test_data</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;2018-01-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-02-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-02-01-23&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-02-01-13&#39;</span><span class="p">]</span> <span class="p">)</span>
<span class="n">CreateTimeStampIndex</span><span class="p">(</span><span class="s2">&quot;TimeStamps&quot;</span><span class="p">)(</span><span class="n">to</span><span class="p">)</span>
<span class="n">AddSeasonalFeatures</span><span class="p">(</span><span class="n">as_cont</span><span class="o">=</span><span class="kc">False</span><span class="p">)(</span><span class="n">to</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">Month</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span> <span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">Day</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">13</span><span class="p">]),</span> <span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">Hour</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="FilterInfinity" class="doc_header"><code>class</code> <code>FilterInfinity</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L410" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>FilterInfinity</code>(<strong><code>cols_to_replace</code></strong>=<em><code>''</code></em>, <strong><code>value_to_replace_with</code></strong>=<em><code>-1</code></em>, <strong><code>replace_not_matching_cols</code></strong>=<em><code>True</code></em>) :: <code>TabularProc</code></p>
</blockquote>
<p>Filter infinity values that occur for example due to preprocessing.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_test_data_infinity</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">get_test_data_infinity</span><span class="p">()</span>
<span class="n">to</span> <span class="o">=</span> <span class="n">TabularPandas</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">procs</span><span class="o">=</span><span class="n">FilterInfinity</span><span class="p">(</span><span class="n">cols_to_replace</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">]),</span> <span class="n">do_setup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cont_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">conts</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="n">test_eq</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">get_test_data_infinity</span><span class="p">()</span>
<span class="n">to</span> <span class="o">=</span> <span class="n">TabularPandas</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">procs</span><span class="o">=</span><span class="n">FilterInfinity</span><span class="p">(</span><span class="n">cols_to_replace</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">],</span> <span class="n">replace_not_matching_cols</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">do_setup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cont_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">conts</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="n">test_eq</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>&lt;ipython-input-43-99a320b29544&gt;:28: UserWarning: Unexpected infinity values in following columns [&#39;B&#39;] that were replaced.
  warnings.warn(warning_message)
&lt;ipython-input-43-99a320b29544&gt;:31: UserWarning: Unexpected infinity values in following columns [&#39;B&#39;] that were not replaced.
  warnings.warn(warning_message)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Filter-Methods">Filter Methods<a class="anchor-link" href="#Filter-Methods"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="FilterByCol" class="doc_header"><code>class</code> <code>FilterByCol</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L442" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>FilterByCol</code>(<strong><code>col_name</code></strong>, <strong><code>drop</code></strong>=<em><code>True</code></em>, <strong><code>drop_col_after_filter</code></strong>=<em><code>True</code></em>) :: <a href="/fastrenewables/tabular.core.html#RenewablesTabularProc"><code>RenewablesTabularProc</code></a></p>
</blockquote>
<p>Filter/Drops rows by a (boolean) column.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">to</span> <span class="o">=</span> <span class="n">get_test_data</span><span class="p">()</span>
<span class="n">to</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s2">&quot;C&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">FilterByCol</span><span class="p">(</span><span class="n">col_name</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="n">drop_col_after_filter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">to</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">index</span><span class="p">),[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">columns</span><span class="p">,[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span><span class="s2">&quot;B&quot;</span><span class="p">])</span>

<span class="n">to</span> <span class="o">=</span> <span class="n">get_test_data</span><span class="p">()</span>
<span class="n">to</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s2">&quot;C&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">FilterByCol</span><span class="p">(</span><span class="n">col_name</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="n">drop_col_after_filter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)(</span><span class="n">to</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">index</span><span class="p">),[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">columns</span><span class="p">,[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="FilterYear" class="doc_header"><code>class</code> <code>FilterYear</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L457" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>FilterYear</code>(<strong><code>year</code></strong>, <strong><code>drop</code></strong>=<em><code>True</code></em>) :: <a href="/fastrenewables/tabular.core.html#RenewablesTabularProc"><code>RenewablesTabularProc</code></a></p>
</blockquote>
<p>Filter/Drops data based on the given year. By default values from the {year} are dropped.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_data_filter_year</span><span class="p">():</span>
    <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2018-01-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-01-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2020-01-02-03&#39;</span><span class="p">,]</span> 
    <span class="k">return</span> <span class="n">TabularPandas</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">index</span><span class="p">),</span>
                      <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    
<span class="n">to</span> <span class="o">=</span> <span class="n">test_data_filter_year</span><span class="p">()</span>
<span class="n">FilterYear</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2018</span><span class="p">)(</span><span class="n">to</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2019</span><span class="p">,</span><span class="mi">2020</span><span class="p">]),</span> <span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
<span class="n">to</span> <span class="o">=</span> <span class="n">test_data_filter_year</span><span class="p">()</span>
<span class="n">FilterYear</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2020</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)(</span><span class="n">to</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2020</span><span class="p">]),</span> <span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
<span class="n">to</span> <span class="o">=</span> <span class="n">test_data_filter_year</span><span class="p">()</span>
<span class="n">FilterYear</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="p">[</span><span class="mi">2018</span><span class="p">,</span><span class="mi">2020</span><span class="p">],</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">to</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2019</span><span class="p">]),</span> <span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
<span class="n">to</span> <span class="o">=</span> <span class="n">test_data_filter_year</span><span class="p">()</span>
<span class="n">FilterYear</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="p">[</span><span class="mi">2018</span><span class="p">,</span><span class="mi">2020</span><span class="p">],</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)(</span><span class="n">to</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2018</span><span class="p">,</span><span class="mi">2020</span><span class="p">]),</span> <span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="FilterHalf" class="doc_header"><code>class</code> <code>FilterHalf</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L476" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>FilterHalf</code>(<strong><code>drop</code></strong>=<em><code>False</code></em>, <strong><code>bydate</code></strong>=<em><code>True</code></em>) :: <a href="/fastrenewables/tabular.core.html#RenewablesTabularProc"><code>RenewablesTabularProc</code></a></p>
</blockquote>
<p>First half of the data is used for training and the other half of validation/testing.
When bydate is true the average date, between the first and last date is used to filter the data.
If bydate is false the amount of data is splitted by half, so that train and validation/testing have an equal amount of available data.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_data_filter_by_half</span><span class="p">(</span><span class="n">procs</span><span class="p">):</span>
    <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2018-01-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-01-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2020-01-02-03&#39;</span><span class="p">,]</span> 
    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="n">TabularPandas</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
                      <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">procs</span><span class="o">=</span><span class="n">procs</span><span class="p">,)</span>

<span class="n">index</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="n">test_data_filter_by_half</span><span class="p">(</span><span class="n">FilterHalf</span><span class="p">())</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">res</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">index</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="n">test_data_filter_by_half</span><span class="p">(</span><span class="n">FilterHalf</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">([</span><span class="n">index</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">res</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="n">index</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="n">test_data_filter_by_half</span><span class="p">(</span><span class="n">FilterHalf</span><span class="p">(</span><span class="n">bydate</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">([</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">res</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">index</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="n">test_data_filter_by_half</span><span class="p">(</span><span class="n">FilterHalf</span><span class="p">(</span><span class="n">bydate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">res</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="FilterMonths" class="doc_header"><code>class</code> <code>FilterMonths</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L505" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>FilterMonths</code>(<strong><code>months</code></strong>=<em><code>range(1, 13)</code></em>, <strong><code>drop</code></strong>=<em><code>False</code></em>) :: <a href="/fastrenewables/tabular.core.html#RenewablesTabularProc"><code>RenewablesTabularProc</code></a></p>
</blockquote>
<p>Filter dataframe based on given months.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_test_data_filter_month</span><span class="p">():</span>
    <span class="n">to</span> <span class="o">=</span> <span class="n">get_test_data</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;2018-01-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-02-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-03-02-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-04-01-23&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-05-01-13&#39;</span><span class="p">])</span>
    <span class="n">CreateTimeStampIndex</span><span class="p">(</span><span class="s2">&quot;TimeStamps&quot;</span><span class="p">)(</span><span class="n">to</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">to</span>

<span class="k">def</span> <span class="nf">test_filter_month</span><span class="p">(</span><span class="n">months</span><span class="p">,</span><span class="n">drop</span><span class="p">,</span><span class="n">expected_result</span><span class="p">):</span>
    <span class="n">to</span> <span class="o">=</span> <span class="n">get_test_data_filter_month</span><span class="p">()</span>
    <span class="n">FilterMonths</span><span class="p">(</span><span class="n">months</span><span class="p">,</span><span class="n">drop</span><span class="p">)(</span><span class="n">to</span><span class="p">)</span>
    <span class="n">test_eq</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">expected_result</span><span class="p">)</span>
    
<span class="n">test_filter_month</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">test_filter_month</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">test_filter_month</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">test_filter_month</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="FilterDays" class="doc_header"><code>class</code> <code>FilterDays</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L518" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>FilterDays</code>(<strong><code>num_days</code></strong>, <strong><code>last</code></strong>=<em><code>True</code></em>, <strong><code>skip</code></strong>=<em><code>False</code></em>, <strong><code>group_by_col</code></strong>=<em><code>'TaskID'</code></em>) :: <a href="/fastrenewables/tabular.core.html#RenewablesTabularProc"><code>RenewablesTabularProc</code></a></p>
</blockquote>
<p>Filter dataframe based on the last/first <code>n</code> number of days.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="DropCols" class="doc_header"><code>class</code> <code>DropCols</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L551" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>DropCols</code>(<strong><code>cols</code></strong>) :: <a href="/fastrenewables/tabular.core.html#RenewablesTabularProc"><code>RenewablesTabularProc</code></a></p>
</blockquote>
<p>Drops rows by a column with boolean values.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">to</span> <span class="o">=</span> <span class="n">get_test_data</span><span class="p">()</span>
<span class="n">DropCols</span><span class="p">(</span><span class="kc">None</span><span class="p">)(</span><span class="n">to</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">])</span>
<span class="n">to</span> <span class="o">=</span> <span class="n">get_test_data</span><span class="p">()</span>
<span class="n">DropCols</span><span class="p">([])(</span><span class="n">to</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">])</span>
<span class="n">to</span> <span class="o">=</span> <span class="n">get_test_data</span><span class="p">()</span>
<span class="n">DropCols</span><span class="p">([</span><span class="s2">&quot;C&quot;</span><span class="p">])(</span><span class="n">to</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">])</span>
<span class="n">to</span> <span class="o">=</span> <span class="n">get_test_data</span><span class="p">()</span>
<span class="n">DropCols</span><span class="p">([</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">])(</span><span class="n">to</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">])</span>
<span class="n">to</span> <span class="o">=</span> <span class="n">get_test_data</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Column-conversion">Column conversion<a class="anchor-link" href="#Column-conversion"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Normalize" class="doc_header"><code>class</code> <code>Normalize</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L562" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Normalize</code>(<strong><code>cols_to_ignore</code></strong>=<em><code>[]</code></em>) :: <a href="/fastrenewables/tabular.core.html#RenewablesTabularProc"><code>RenewablesTabularProc</code></a></p>
</blockquote>
<p>Normalize per TaskId</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As we assume, that we have NWP as input features, we can always extract the past. 
Therefore, we should normalize before filtering the data.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">Normalize</span><span class="o">.</span><span class="n">order</span><span class="o">&lt;</span><span class="n">FilterMonths</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">Normalize</span><span class="o">.</span><span class="n">order</span><span class="o">&lt;</span><span class="n">FilterByCol</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">Normalize</span><span class="o">.</span><span class="n">order</span><span class="o">&lt;</span><span class="n">FilterYear</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BinFeatures" class="doc_header"><code>class</code> <code>BinFeatures</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L581" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BinFeatures</code>(<strong><code>column_names</code></strong>, <strong><code>bin_sizes</code></strong>=<em><code>5</code></em>) :: <code>TabularProc</code></p>
</blockquote>
<p>Creates bin from categorical features.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test corner cases of minimum and maximum.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;ABCD&#39;</span><span class="p">))</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">to</span> <span class="o">=</span> <span class="n">TabularPandas</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">cont_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">],</span> <span class="n">y_names</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">procs</span><span class="o">=</span><span class="n">BinFeatures</span><span class="p">(</span><span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">]))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:][[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,:][[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="c1"># Test for nas.</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Check if it is also works along with categorify.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;ABCD&#39;</span><span class="p">))</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">to</span> <span class="o">=</span> <span class="n">TabularPandas</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">cont_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">],</span> <span class="n">y_names</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">procs</span><span class="o">=</span><span class="p">[</span><span class="n">BinFeatures</span><span class="p">(</span><span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">]),</span> <span class="n">Categorify</span><span class="p">()])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:][[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,:][[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Extension-of-TabularPandas-with-pre-processing">Extension of TabularPandas with pre-processing<a class="anchor-link" href="#Extension-of-TabularPandas-with-pre-processing"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fastai.tabular.core</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="RenewableSplits" class="doc_header"><code>class</code> <code>RenewableSplits</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L609" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>RenewableSplits</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ByWeeksSplitter" class="doc_header"><code>class</code> <code>ByWeeksSplitter</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L613" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ByWeeksSplitter</code>(<strong><code>every_n_weeks</code></strong>:<code>int</code>=<em><code>4</code></em>) :: <a href="/fastrenewables/tabular.core.html#RenewableSplits"><code>RenewableSplits</code></a></p>
</blockquote>
<p>Train/Validation splits every <code>n</code> weeks.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TrainTestSplitByDays" class="doc_header"><code>class</code> <code>TrainTestSplitByDays</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L630" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TrainTestSplitByDays</code>(<strong><code>test_size</code></strong>:<code>float</code>=<em><code>0.25</code></em>) :: <a href="/fastrenewables/tabular.core.html#RenewableSplits"><code>RenewableSplits</code></a></p>
</blockquote>
<p>Train/Validation splits by days, so that each sample is a <code>complete</code> day.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TabularRenewables" class="doc_header"><code>class</code> <code>TabularRenewables</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L651" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TabularRenewables</code>(<strong><code>dfs</code></strong>, <strong><code>procs</code></strong>=<em><code>None</code></em>, <strong><code>cat_names</code></strong>=<em><code>None</code></em>, <strong><code>cont_names</code></strong>=<em><code>None</code></em>, <strong><code>do_setup</code></strong>=<em><code>True</code></em>, <strong><code>reduce_memory</code></strong>=<em><code>False</code></em>, <strong><code>y_names</code></strong>=<em><code>None</code></em>, <strong><code>add_y_to_x</code></strong>=<em><code>False</code></em>, <strong><code>add_x_to_y</code></strong>=<em><code>False</code></em>, <strong><code>pre_process</code></strong>=<em><code>None</code></em>, <strong><code>device</code></strong>=<em><code>None</code></em>, <strong><code>splits</code></strong>=<em><code>None</code></em>, <strong><code>y_block</code></strong>=<em><code>&lt;fastai.data.block.TransformBlock object at 0x7f0266238820&gt;</code></em>, <strong><code>group_id</code></strong>=<em><code>'TaskID'</code></em>, <strong><code>inplace</code></strong>=<em><code>False</code></em>) :: <code>TabularPandas</code></p>
</blockquote>
<p>TabularRenewables class that extends the TabularPandas class to include pre processing steps that allows for dropping values.
Further, the preprocessing allows handling multiple tasks at once, e.g., normalization per task.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Custom-Dataloader">Custom Dataloader<a class="anchor-link" href="#Custom-Dataloader"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ReadTabBatchRenewables" class="doc_header"><code>class</code> <code>ReadTabBatchRenewables</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L783" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ReadTabBatchRenewables</code>(<strong><code>to</code></strong>) :: <code>ItemTransform</code></p>
</blockquote>
<p>Transform <code>TabularPandas</code> values into a <code>Tensor</code> with the ability to decode</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TabDataLoaderRenewables" class="doc_header"><code>class</code> <code>TabDataLoaderRenewables</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L831" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TabDataLoaderRenewables</code>(<strong><code>dataset</code></strong>, <strong><code>bs</code></strong>=<em><code>16</code></em>, <strong><code>shuffle</code></strong>=<em><code>False</code></em>, <strong><code>after_batch</code></strong>=<em><code>None</code></em>, <strong><code>num_workers</code></strong>=<em><code>0</code></em>, <strong><code>verbose</code></strong>=<em><code>False</code></em>, <strong><code>do_setup</code></strong>=<em><code>True</code></em>, <strong><code>pin_memory</code></strong>=<em><code>False</code></em>, <strong><code>timeout</code></strong>=<em><code>0</code></em>, <strong><code>batch_size</code></strong>=<em><code>None</code></em>, <strong><code>drop_last</code></strong>=<em><code>False</code></em>, <strong><code>indexed</code></strong>=<em><code>None</code></em>, <strong><code>n</code></strong>=<em><code>None</code></em>, <strong><code>device</code></strong>=<em><code>None</code></em>, <strong><code>persistent_workers</code></strong>=<em><code>False</code></em>, <strong><code>wif</code></strong>=<em><code>None</code></em>, <strong><code>before_iter</code></strong>=<em><code>None</code></em>, <strong><code>after_item</code></strong>=<em><code>None</code></em>, <strong><code>before_batch</code></strong>=<em><code>None</code></em>, <strong><code>after_iter</code></strong>=<em><code>None</code></em>, <strong><code>create_batches</code></strong>=<em><code>None</code></em>, <strong><code>create_item</code></strong>=<em><code>None</code></em>, <strong><code>create_batch</code></strong>=<em><code>None</code></em>, <strong><code>retain</code></strong>=<em><code>None</code></em>, <strong><code>get_idxs</code></strong>=<em><code>None</code></em>, <strong><code>sample</code></strong>=<em><code>None</code></em>, <strong><code>shuffle_fn</code></strong>=<em><code>None</code></em>, <strong><code>do_batch</code></strong>=<em><code>None</code></em>) :: <code>TfmdDL</code></p>
</blockquote>
<p>A transformed <code>DataLoader</code> for Tabular data</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="unique_cols" class="doc_header"><code>unique_cols</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L845" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>unique_cols</code>(<strong><code>df</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="NormalizePerTask" class="doc_header"><code>class</code> <code>NormalizePerTask</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L849" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>NormalizePerTask</code>(<strong><code>task_id_col</code></strong>=<em><code>'TaskID'</code></em>, <strong><code>ignore_cont_cols</code></strong>=<em><code>[]</code></em>, <strong><code>norm_type</code></strong>=<em><code>'znorm'</code></em>) :: <code>TabularProc</code></p>
</blockquote>
<p>Normalize per TaskId. Either via z-normalization (znorm) or min-max normalization (minmaxnorm)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_test_data_task_normalization</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">procs</span><span class="o">=</span><span class="n">NormalizePerTask</span><span class="p">,</span> <span class="n">ignore_cols</span> <span class="o">=</span> <span class="n">L</span><span class="p">(),</span> 
                                     <span class="n">norm_type</span><span class="o">=</span><span class="s2">&quot;znorm&quot;</span><span class="p">,</span> <span class="n">cat_names</span> <span class="o">=</span> <span class="s2">&quot;TaskID&quot;</span><span class="p">,</span> <span class="n">y_names</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> 
                                     <span class="n">y_block</span><span class="o">=</span><span class="n">RegressionBlock</span><span class="p">()):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">),</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="p">,</span> 
                      <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">21</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">))])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    
    <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;TimeStamps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
    
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;TaskID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">5</span>  <span class="k">else</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">))</span>
    
    <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2015-01-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-01-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-01-02-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-02-01-23&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-02-01-13&#39;</span><span class="p">,</span>
        <span class="s1">&#39;2016-01-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2016-01-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2016-06-02-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2016-02-01-23&#39;</span><span class="p">,</span> <span class="s1">&#39;2016-02-01-13&#39;</span><span class="p">]</span> 
    
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;TimeStamps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
    
    <span class="n">to</span> <span class="o">=</span> <span class="n">TabularRenewables</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> 
                           <span class="n">pre_process</span><span class="o">=</span><span class="n">CreateTimeStampIndex</span><span class="p">(</span><span class="n">index_col_name</span><span class="o">=</span><span class="s2">&quot;TimeStamps&quot;</span><span class="p">),</span> 
                           <span class="n">procs</span><span class="o">=</span><span class="p">[</span><span class="n">NormalizePerTask</span><span class="p">(</span><span class="n">ignore_cont_cols</span><span class="o">=</span><span class="n">ignore_cols</span><span class="p">,</span> <span class="n">norm_type</span><span class="o">=</span><span class="n">norm_type</span><span class="p">)],</span> 
                           <span class="n">cont_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="p">,</span> 
                           <span class="n">y_names</span><span class="o">=</span><span class="n">y_names</span><span class="p">,</span> 
                           <span class="n">cat_names</span><span class="o">=</span><span class="n">cat_names</span><span class="p">,</span>
                           <span class="n">do_setup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">y_block</span><span class="o">=</span><span class="n">y_block</span>
                          <span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;TimeStamps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;TimeStamps&quot;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">,</span><span class="n">to</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">original_df</span><span class="p">,</span> <span class="n">to</span> <span class="o">=</span> <span class="n">get_test_data_task_normalization</span><span class="p">()</span>
<span class="n">test_close</span><span class="p">(</span><span class="n">original_df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span><span class="mi">13</span><span class="p">],[</span><span class="mi">8</span><span class="p">,</span><span class="mi">18</span><span class="p">]]),</span> <span class="n">to</span><span class="o">.</span><span class="n">normalize_per_task</span><span class="o">.</span><span class="n">means</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">test_close</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.41421366</span><span class="p">,</span> <span class="mf">1.41421366</span><span class="p">],[</span><span class="mf">1.41421366</span><span class="p">,</span> <span class="mf">1.41421366</span><span class="p">]]),</span> <span class="n">to</span><span class="o">.</span><span class="n">normalize_per_task</span><span class="o">.</span><span class="n">stds</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">to</span><span class="o">.</span><span class="n">normalize_per_task</span><span class="o">.</span><span class="n">means</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">to</span><span class="o">.</span><span class="n">normalize_per_task</span><span class="o">.</span><span class="n">stds</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">original_df</span><span class="p">,</span> <span class="n">to</span> <span class="o">=</span> <span class="n">get_test_data_task_normalization</span><span class="p">(</span><span class="n">ignore_cols</span><span class="o">=</span><span class="n">L</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">),</span> <span class="n">norm_type</span><span class="o">=</span><span class="s2">&quot;minmaxnorm&quot;</span><span class="p">)</span>
<span class="n">test_close</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">test_close</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">test_close</span><span class="p">(</span><span class="n">original_df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">to</span><span class="o">.</span><span class="n">normalize_per_task</span><span class="o">.</span><span class="n">means</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">to</span><span class="o">.</span><span class="n">normalize_per_task</span><span class="o">.</span><span class="n">stds</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">test_close</span><span class="p">([</span><span class="mi">11</span><span class="p">,</span><span class="mi">16</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">normalize_per_task</span><span class="o">.</span><span class="n">mins</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
<span class="n">test_close</span><span class="p">([</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">normalize_per_task</span><span class="o">.</span><span class="n">maxs</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="VerifyAndNormalizeTarget" class="doc_header"><code>class</code> <code>VerifyAndNormalizeTarget</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L929" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>VerifyAndNormalizeTarget</code>(<strong><code>reset_min_value</code></strong>=<em><code>0.0</code></em>, <strong><code>reset_max_value</code></strong>=<em><code>1.05</code></em>, <strong><code>max_value_for_normalization</code></strong>=<em><code>1.5</code></em>, <strong><code>task_id_col</code></strong>=<em><code>'TaskID'</code></em>) :: <code>TabularProc</code></p>
</blockquote>
<p>Normalize per TaskId</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_test_data_task_target_normalization</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reset_min_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">reset_max_value</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> \
                 <span class="n">max_value_for_normalization</span><span class="o">=</span><span class="mf">1.5</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">),</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="p">,</span> 
                      <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">21</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="mi">31</span><span class="p">))])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;TimeStamps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;TaskID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">5</span>  <span class="k">else</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">))</span>
    <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2015-01-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-01-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-01-02-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-02-01-23&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-02-01-13&#39;</span><span class="p">,</span>
        <span class="s1">&#39;2016-01-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2016-01-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2016-06-02-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2016-02-01-23&#39;</span><span class="p">,</span> <span class="s1">&#39;2016-02-01-13&#39;</span><span class="p">]</span> 
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;TimeStamps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
    <span class="n">to</span> <span class="o">=</span> <span class="n">TabularRenewables</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">pre_process</span><span class="o">=</span><span class="n">CreateTimeStampIndex</span><span class="p">(</span><span class="n">index_col_name</span><span class="o">=</span><span class="s2">&quot;TimeStamps&quot;</span><span class="p">),</span> 
                           <span class="n">procs</span><span class="o">=</span><span class="p">[</span><span class="n">VerifyAndNormalizeTarget</span><span class="p">(</span><span class="n">reset_min_value</span><span class="p">,</span><span class="n">reset_max_value</span><span class="p">,</span>
                                                           <span class="n">max_value_for_normalization</span><span class="p">)],</span> 
                           <span class="n">cont_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">]</span> <span class="p">,</span> <span class="n">y_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">],</span> 
                           <span class="n">cat_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;TaskID&quot;</span><span class="p">]</span>
                          <span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;TimeStamps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;TimeStamps&quot;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">,</span><span class="n">to</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">,</span><span class="n">to</span> <span class="o">=</span> <span class="n">get_test_data_task_target_normalization</span><span class="p">(</span><span class="n">reset_min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">reset_max_value</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> 
                                                <span class="n">max_value_for_normalization</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="c1"># all values are larger than max_value_for_normalization, so all tasks should be normalized</span>
<span class="n">test_close</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">test_close</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="n">df</span><span class="p">,</span><span class="n">to</span> <span class="o">=</span> <span class="n">get_test_data_task_target_normalization</span><span class="p">(</span><span class="n">reset_min_value</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">reset_max_value</span><span class="o">=</span><span class="mi">29</span><span class="p">,</span> 
                                                <span class="n">max_value_for_normalization</span><span class="o">=</span><span class="mi">35</span><span class="p">)</span>

<span class="c1"># everything is lower than 22, so all values should be 22 for feature B</span>
<span class="n">test_close</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">ys</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">test_close</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">ys</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">test_close</span><span class="p">(</span><span class="mi">29</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">ys</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Numpy-Dataloader">Numpy Dataloader<a class="anchor-link" href="#Numpy-Dataloader"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TabDataset" class="doc_header"><code>class</code> <code>TabDataset</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L974" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TabDataset</code>(<strong><code>x</code></strong>=<em><code>None</code></em>, <strong>*<code>rest</code></strong>) :: <code>fastuple</code></p>
</blockquote>
<p>A dataset from a <code>TabularRenewable</code> object</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TabDataLoader" class="doc_header"><code>class</code> <code>TabDataLoader</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L1008" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TabDataLoader</code>(<strong><code>dataset</code></strong>, <strong><code>bs</code></strong>=<em><code>32</code></em>, <strong><code>num_workers</code></strong>=<em><code>0</code></em>, <strong><code>device</code></strong>=<em><code>'cuda'</code></em>, <strong><code>to_device</code></strong>=<em><code>True</code></em>, <strong><code>shuffle</code></strong>=<em><code>False</code></em>, <strong><code>drop_last</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>) :: <code>DataLoader</code></p>
</blockquote>
<p>API compatible with PyTorch DataLoader, with a lot more callbacks and flexibility</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TabDataLoaders" class="doc_header"><code>class</code> <code>TabDataLoaders</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/core.py#L1047" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TabDataLoaders</code>(<strong><code>to</code></strong>, <strong><code>bs</code></strong>=<em><code>64</code></em>, <strong><code>val_bs</code></strong>=<em><code>None</code></em>, <strong><code>shuffle_train</code></strong>=<em><code>True</code></em>, <strong><code>device</code></strong>=<em><code>'cpu'</code></em>, <strong>**<code>kwargs</code></strong>) :: <code>DataLoaders</code></p>
</blockquote>
<p>A container for train and validation (tabular) dataloaders.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Integration-Example">Integration Example<a class="anchor-link" href="#Integration-Example"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Lets verify that we can the split the data by weeks. 
Splitting by weeks often allows to achieve an representative validation error while reducing training effort
compared to cross validation. In this scenario four weeks are considered as training data and the next week is 
validation data, then the next four weeks are consisdered as training data, and so forth.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;1/1/2018&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;31/12/2018&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;6H&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-01-01 00:00:00</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2018-01-01 06:00:00</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2018-01-01 12:00:00</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2018-01-01 18:00:00</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2018-01-02 00:00:00</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">to</span> <span class="o">=</span> <span class="n">TabularRenewables</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">y_names</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="n">procs</span><span class="o">=</span><span class="n">Normalize</span><span class="p">,</span> 
                  <span class="n">pre_process</span><span class="o">=</span><span class="n">AddSeasonalFeatures</span><span class="p">,</span> 
                  <span class="n">splits</span><span class="o">=</span><span class="n">ByWeeksSplitter</span><span class="p">(</span><span class="n">every_n_weeks</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
                       <span class="n">y_block</span><span class="o">=</span><span class="n">RegressionBlock</span><span class="p">()</span>
                  <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>E.g. the first and fifth week is accounted as validation data.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">to</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isocalendar</span><span class="p">()</span><span class="o">.</span><span class="n">week</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">30</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>2018-02-04 00:00:00     5
2018-02-04 06:00:00     5
2018-02-04 12:00:00     5
2018-02-04 18:00:00     5
2018-03-05 00:00:00    10
2018-03-05 06:00:00    10
Name: week, dtype: UInt32</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Lets create a dataloader and show a single batch.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">original_df</span><span class="p">,</span> <span class="n">to</span> <span class="o">=</span> <span class="n">get_test_data_task_normalization</span><span class="p">()</span>
<span class="n">dl</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">bs</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>normalized data:</strong></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">to</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>                                  A         B  C  TaskID
TimeUTC                                                 
2015-01-01 01:00:00+00:00 -1.414213 -1.414213  0       1
2015-01-01 02:00:00+00:00 -0.707107 -0.707107  1       1
2015-01-02 03:00:00+00:00  0.000000  0.000000  2       1
2015-02-01 23:00:00+00:00  0.707107  0.707107  3       1
2015-02-01 13:00:00+00:00  1.414213  1.414213  4       1
2016-01-01 01:00:00+00:00 -1.414213 -1.414213  5       2
2016-01-01 02:00:00+00:00 -0.707107 -0.707107  6       2
2016-06-02 03:00:00+00:00  0.000000  0.000000  7       2
2016-02-01 23:00:00+00:00  0.707107  0.707107  8       2
2016-02-01 13:00:00+00:00  1.414213  1.414213  9       2</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>decode data (denormalized)</strong></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">to</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TaskID</th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
    <tr>
      <th>TimeUTC</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-01-01 01:00:00+00:00</th>
      <td>1</td>
      <td>1.0</td>
      <td>11.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2015-01-01 02:00:00+00:00</th>
      <td>1</td>
      <td>2.0</td>
      <td>12.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2015-01-02 03:00:00+00:00</th>
      <td>1</td>
      <td>3.0</td>
      <td>13.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2015-02-01 23:00:00+00:00</th>
      <td>1</td>
      <td>4.0</td>
      <td>14.0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2015-02-01 13:00:00+00:00</th>
      <td>1</td>
      <td>5.0</td>
      <td>15.0</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2016-01-01 01:00:00+00:00</th>
      <td>2</td>
      <td>6.0</td>
      <td>16.0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2016-01-01 02:00:00+00:00</th>
      <td>2</td>
      <td>7.0</td>
      <td>17.0</td>
      <td>6</td>
    </tr>
    <tr>
      <th>2016-06-02 03:00:00+00:00</th>
      <td>2</td>
      <td>8.0</td>
      <td>18.0</td>
      <td>7</td>
    </tr>
    <tr>
      <th>2016-02-01 23:00:00+00:00</th>
      <td>2</td>
      <td>9.0</td>
      <td>19.0</td>
      <td>8</td>
    </tr>
    <tr>
      <th>2016-02-01 13:00:00+00:00</th>
      <td>2</td>
      <td>10.0</td>
      <td>20.0</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>the original input dataframe:</strong></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">original_df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>TaskID</th>
    </tr>
    <tr>
      <th>TimeStamps</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-01-01 01:00:00+00:00</th>
      <td>1</td>
      <td>11</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2015-01-01 02:00:00+00:00</th>
      <td>2</td>
      <td>12</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2015-01-02 03:00:00+00:00</th>
      <td>3</td>
      <td>13</td>
      <td>2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2015-02-01 23:00:00+00:00</th>
      <td>4</td>
      <td>14</td>
      <td>3</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2015-02-01 13:00:00+00:00</th>
      <td>5</td>
      <td>15</td>
      <td>4</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2016-01-01 01:00:00+00:00</th>
      <td>6</td>
      <td>16</td>
      <td>5</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2016-01-01 02:00:00+00:00</th>
      <td>7</td>
      <td>17</td>
      <td>6</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2016-06-02 03:00:00+00:00</th>
      <td>8</td>
      <td>18</td>
      <td>7</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2016-02-01 23:00:00+00:00</th>
      <td>9</td>
      <td>19</td>
      <td>8</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2016-02-01 13:00:00+00:00</th>
      <td>10</td>
      <td>20</td>
      <td>9</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dl</span><span class="o">.</span><span class="n">one_batch</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(tensor([[1],
         [1],
         [2],
         [1]]),
 tensor([[ 0.0000,  0.0000],
         [-1.4142, -1.4142],
         [-0.7071, -0.7071],
         [ 0.7071,  0.7071]]),
 tensor([[2.],
         [0.],
         [6.],
         [3.]]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The following gives an example on how to add a new task, that is normalized based on the first year. E.g. when the features are numerical weather predictions. As those are themselves forecasts, we can always extract the past and use the data for standardization.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">original_df</span><span class="p">,</span> <span class="n">to</span> <span class="o">=</span> <span class="n">get_test_data_task_normalization</span><span class="p">()</span>
<span class="n">original_df</span><span class="p">[</span><span class="s2">&quot;TaskID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">chained_assignment</span><span class="o">=</span><span class="kc">None</span>
<span class="c1"># setups task normalization</span>
<span class="n">to_new</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">original_df</span><span class="p">,</span> <span class="n">pre_process</span><span class="o">=</span><span class="n">FilterYear</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">to_new</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
<span class="n">to_new</span><span class="o">.</span><span class="n">items</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>TaskID</th>
    </tr>
    <tr>
      <th>TimeStamps</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-01-01 01:00:00+00:00</th>
      <td>-1.414213</td>
      <td>-1.414213</td>
      <td>0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2015-01-01 02:00:00+00:00</th>
      <td>-0.707107</td>
      <td>-0.707107</td>
      <td>1</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2015-01-02 03:00:00+00:00</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2015-02-01 23:00:00+00:00</th>
      <td>0.707107</td>
      <td>0.707107</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2015-02-01 13:00:00+00:00</th>
      <td>1.414213</td>
      <td>1.414213</td>
      <td>4</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">to_new</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>TaskID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>5.000000e+00</td>
      <td>5.000000e+00</td>
      <td>5.000000</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>-4.440892e-17</td>
      <td>-4.440892e-17</td>
      <td>2.000000</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>std</th>
      <td>1.118034e+00</td>
      <td>1.118034e+00</td>
      <td>1.581139</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-1.414213e+00</td>
      <td>-1.414213e+00</td>
      <td>0.000000</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-7.071067e-01</td>
      <td>-7.071067e-01</td>
      <td>1.000000</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>2.000000</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>7.071067e-01</td>
      <td>7.071067e-01</td>
      <td>3.000000</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.414213e+00</td>
      <td>1.414213e+00</td>
      <td>4.000000</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Normalize the second year based on the mean and std of the first year.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">to_new</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">original_df</span><span class="p">,</span> <span class="n">pre_process</span><span class="o">=</span><span class="n">FilterYear</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="n">to_new</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As the data has larger values in the second year, the normalization is quite off.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">to_new</span><span class="o">.</span><span class="n">items</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>TaskID</th>
    </tr>
    <tr>
      <th>TimeStamps</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2016-01-01 01:00:00+00:00</th>
      <td>2.121320</td>
      <td>2.121320</td>
      <td>5</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2016-01-01 02:00:00+00:00</th>
      <td>2.828427</td>
      <td>2.828427</td>
      <td>6</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2016-06-02 03:00:00+00:00</th>
      <td>3.535534</td>
      <td>3.535534</td>
      <td>7</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2016-02-01 23:00:00+00:00</th>
      <td>4.242640</td>
      <td>4.242640</td>
      <td>8</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2016-02-01 13:00:00+00:00</th>
      <td>4.949747</td>
      <td>4.949747</td>
      <td>9</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This can also be seen in the summary:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">to_new</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>TaskID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>3.535534</td>
      <td>3.535534</td>
      <td>7.000000</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>std</th>
      <td>1.118034</td>
      <td>1.118034</td>
      <td>1.581139</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>min</th>
      <td>2.121320</td>
      <td>2.121320</td>
      <td>5.000000</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>2.828427</td>
      <td>2.828427</td>
      <td>6.000000</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>3.535534</td>
      <td>3.535534</td>
      <td>7.000000</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>4.242640</td>
      <td>4.242640</td>
      <td>8.000000</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>max</th>
      <td>4.949747</td>
      <td>4.949747</td>
      <td>9.000000</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's check a dataloader and verify if we can display the data.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">to_new</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">bs</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">show_batch</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TaskID</th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>8.0</td>
      <td>18.0</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3</td>
      <td>6.0</td>
      <td>16.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>7.0</td>
      <td>17.0</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>9.0</td>
      <td>19.0</td>
      <td>8.0</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

