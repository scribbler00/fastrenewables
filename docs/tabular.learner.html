---

title: learner


keywords: fastai
sidebar: home_sidebar

summary: "API details."
description: "API details."
nb_path: "nbs/04_tabular.learner.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/04_tabular.learner.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">long</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>int</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="RenewableLearner" class="doc_header"><code>class</code> <code>RenewableLearner</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/learner.py#L18" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>RenewableLearner</code>(<strong><code>dls</code></strong>, <strong><code>model</code></strong>, <strong><code>loss_func</code></strong>=<em><code>None</code></em>, <strong><code>opt_func</code></strong>=<em><code>Adam</code></em>, <strong><code>lr</code></strong>=<em><code>0.001</code></em>, <strong><code>splitter</code></strong>=<em><code>trainable_params</code></em>, <strong><code>cbs</code></strong>=<em><code>None</code></em>, <strong><code>metrics</code></strong>=<em><code>None</code></em>, <strong><code>path</code></strong>=<em><code>None</code></em>, <strong><code>model_dir</code></strong>=<em><code>'models'</code></em>, <strong><code>wd</code></strong>=<em><code>None</code></em>, <strong><code>wd_bn_bias</code></strong>=<em><code>False</code></em>, <strong><code>train_bn</code></strong>=<em><code>True</code></em>, <strong><code>moms</code></strong>=<em><code>(0.95, 0.85, 0.95)</code></em>) :: <code>Learner</code></p>
</blockquote>
<p><code>Learner</code> for renewable data</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cont_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;T_HAG_2_M&#39;</span><span class="p">,</span> <span class="s1">&#39;RELHUM_HAG_2_M&#39;</span><span class="p">,</span> <span class="s1">&#39;PS_SFC_0_M&#39;</span><span class="p">,</span> <span class="s1">&#39;ASWDIFDS_SFC_0_M&#39;</span><span class="p">,</span>
       <span class="s1">&#39;ASWDIRS_SFC_0_M&#39;</span><span class="p">,</span> <span class="s1">&#39;WindSpeed58m&#39;</span><span class="p">]</span>
<span class="n">cat_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;TaskID&#39;</span><span class="p">,</span> <span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="s1">&#39;Day&#39;</span><span class="p">,</span> <span class="s1">&#39;Hour&#39;</span><span class="p">]</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">chained_assignment</span><span class="o">=</span><span class="kc">None</span>
<span class="n">dls</span> <span class="o">=</span> <span class="n">RenewableDataLoaders</span><span class="o">.</span><span class="n">from_files</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;../data/*.h5&quot;</span><span class="p">),</span> <span class="n">y_names</span><span class="o">=</span><span class="s2">&quot;PowerGeneration&quot;</span><span class="p">,</span> 
                                      <span class="n">pre_procs</span><span class="o">=</span><span class="p">[</span><span class="n">FilterYear</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2020</span><span class="p">),</span> 
                                                 <span class="n">AddSeasonalFeatures</span><span class="p">(</span><span class="n">as_cont</span><span class="o">=</span><span class="kc">False</span><span class="p">)],</span> 
                                      <span class="n">cat_names</span><span class="o">=</span><span class="n">cat_names</span><span class="p">,</span> <span class="n">cont_names</span><span class="o">=</span><span class="n">cont_names</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="renewable_learner" class="doc_header"><code>renewable_learner</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/learner.py#L54" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>renewable_learner</code>(<strong><code>dls</code></strong>, <strong><code>layers</code></strong>=<em><code>None</code></em>, <strong><code>emb_szs</code></strong>=<em><code>None</code></em>, <strong><code>config</code></strong>=<em><code>None</code></em>, <strong><code>n_out</code></strong>=<em><code>None</code></em>, <strong><code>y_range</code></strong>=<em><code>None</code></em>, <strong><code>embedding_type</code></strong>=<em><code>&lt;EmbeddingType.Normal: 0&gt;</code></em>, <strong><code>loss_func</code></strong>=<em><code>None</code></em>, <strong><code>opt_func</code></strong>=<em><code>Adam</code></em>, <strong><code>lr</code></strong>=<em><code>0.001</code></em>, <strong><code>splitter</code></strong>=<em><code>trainable_params</code></em>, <strong><code>cbs</code></strong>=<em><code>None</code></em>, <strong><code>metrics</code></strong>=<em><code>None</code></em>, <strong><code>path</code></strong>=<em><code>None</code></em>, <strong><code>model_dir</code></strong>=<em><code>'models'</code></em>, <strong><code>wd</code></strong>=<em><code>None</code></em>, <strong><code>wd_bn_bias</code></strong>=<em><code>False</code></em>, <strong><code>train_bn</code></strong>=<em><code>True</code></em>, <strong><code>moms</code></strong>=<em><code>(0.95, 0.85, 0.95)</code></em>)</p>
</blockquote>
<p>Get a <code>Learner</code> using <code>dls</code>, with <code>metrics</code>, including a <code>TabularModel</code> created using the remaining params.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">renewable_learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">rmse</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span><span class="o">.</span><span class="n">show_batch</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TaskID</th>
      <th>Month</th>
      <th>Day</th>
      <th>Hour</th>
      <th>T_HAG_2_M</th>
      <th>RELHUM_HAG_2_M</th>
      <th>PS_SFC_0_M</th>
      <th>ASWDIFDS_SFC_0_M</th>
      <th>ASWDIRS_SFC_0_M</th>
      <th>WindSpeed58m</th>
      <th>PowerGeneration</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>11</td>
      <td>22</td>
      <td>19</td>
      <td>274.521</td>
      <td>93.115999</td>
      <td>97203.214978</td>
      <td>38.393001</td>
      <td>8.624999</td>
      <td>2.200401</td>
      <td>0.017</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>3</td>
      <td>14</td>
      <td>5</td>
      <td>277.642</td>
      <td>80.636000</td>
      <td>99620.723010</td>
      <td>56.420000</td>
      <td>4.266001</td>
      <td>6.164633</td>
      <td>0.134</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>10</td>
      <td>8</td>
      <td>19</td>
      <td>284.353</td>
      <td>93.917000</td>
      <td>97377.358978</td>
      <td>38.499000</td>
      <td>14.476999</td>
      <td>8.565258</td>
      <td>0.150</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>5</td>
      <td>29</td>
      <td>9</td>
      <td>284.972</td>
      <td>69.292000</td>
      <td>93429.566003</td>
      <td>99.847000</td>
      <td>23.871002</td>
      <td>5.777053</td>
      <td>0.092</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>4</td>
      <td>23</td>
      <td>3</td>
      <td>280.034</td>
      <td>65.099000</td>
      <td>96929.590040</td>
      <td>51.098000</td>
      <td>193.095000</td>
      <td>5.372576</td>
      <td>0.041</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2</td>
      <td>1</td>
      <td>27</td>
      <td>3</td>
      <td>272.914</td>
      <td>91.351000</td>
      <td>91737.972986</td>
      <td>29.742001</td>
      <td>3.800997</td>
      <td>4.974804</td>
      <td>0.126</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1</td>
      <td>3</td>
      <td>20</td>
      <td>10</td>
      <td>280.145</td>
      <td>58.037000</td>
      <td>99861.651958</td>
      <td>51.482000</td>
      <td>109.617999</td>
      <td>2.915605</td>
      <td>0.054</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2</td>
      <td>11</td>
      <td>3</td>
      <td>17</td>
      <td>281.462</td>
      <td>69.377000</td>
      <td>90840.137057</td>
      <td>42.210001</td>
      <td>19.737999</td>
      <td>15.319545</td>
      <td>0.037</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1</td>
      <td>7</td>
      <td>14</td>
      <td>0</td>
      <td>286.722</td>
      <td>93.051001</td>
      <td>98198.473000</td>
      <td>69.326000</td>
      <td>25.054999</td>
      <td>2.073009</td>
      <td>0.001</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1</td>
      <td>10</td>
      <td>25</td>
      <td>18</td>
      <td>283.998</td>
      <td>84.012000</td>
      <td>98637.234026</td>
      <td>46.888000</td>
      <td>58.942001</td>
      <td>5.742680</td>
      <td>0.019</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>_rmse</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.014980</td>
      <td>0.013650</td>
      <td>0.116834</td>
      <td>00:03</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n_conts</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dls</span><span class="o">.</span><span class="n">cont_names</span><span class="p">)</span>
<span class="n">hidden_layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_conts</span><span class="p">]</span> <span class="o">+</span> <span class="n">get_structure</span><span class="p">(</span><span class="n">n_conts</span><span class="o">*</span><span class="mi">20</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">learn</span> <span class="o">=</span> <span class="n">renewable_learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">rmse</span><span class="p">,</span> <span class="n">layers</span><span class="o">=</span><span class="n">hidden_layers</span><span class="p">,</span> <span class="n">embedding_type</span><span class="o">=</span><span class="n">EmbeddingType</span><span class="o">.</span><span class="n">Bayes</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>MultiLayerPerceptron (Input shape: 64 x torch.Size([64, 6]))
============================================================================
Layer (type)         Output Shape         Param #    Trainable 
============================================================================
                     64 x 3              
Embedding                                 12         True      
____________________________________________________________________________
                     64 x 7              
Embedding                                 91         True      
____________________________________________________________________________
                     64 x 11             
Embedding                                 352        True      
____________________________________________________________________________
                     64 x 10             
Embedding                                 250        True      
Dropout                                                        
Identity                                                       
BatchNorm1d                               12         True      
BatchNorm1d                               74         True      
____________________________________________________________________________
                     64 x 120            
Linear                                    4440       True      
ReLU                                                           
BatchNorm1d                               240        True      
____________________________________________________________________________
                     64 x 12             
Linear                                    1440       True      
ReLU                                                           
BatchNorm1d                               24         True      
____________________________________________________________________________
                     64 x 10             
Linear                                    120        True      
ReLU                                                           
____________________________________________________________________________
                     64 x 1              
Linear                                    11         True      
____________________________________________________________________________

Total params: 7,066
Total trainable params: 7,066
Total non-trainable params: 0

Optimizer used: &lt;function Adam at 0x7f30001e5280&gt;
Loss function: VILoss(
  (base_loss):FlattenedLoss of MSELoss()
  (kl_weight): 0.1 
)

Callbacks:
  - TrainEvalCallback
  - Recorder
  - ProgressCallback</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

    <div>
        <style>
            /* Turns off some styling */
            progress {
                /* gets rid of default border in Firefox and Opera. */
                border: none;
                /* Needs to be in here for Safari polyfill so background images work as expected. */
                background-size: auto;
            }
            .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
                background: #F44336;
            }
        </style>
      <progress value='0' class='' max='1' style='width:300px; height:20px; vertical-align: middle;'></progress>
      0.00% [0/1 00:00<00:00]
    </div>
    
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>_rmse</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table><p>

    <div>
        <style>
            /* Turns off some styling */
            progress {
                /* gets rid of default border in Firefox and Opera. */
                border: none;
                /* Needs to be in here for Safari polyfill so background images work as expected. */
                background-size: auto;
            }
            .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
                background: #F44336;
            }
        </style>
      <progress value='239' class='' max='320' style='width:300px; height:20px; vertical-align: middle;'></progress>
      74.69% [239/320 00:02<00:00 0.0183]
    </div>
    
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preds</span><span class="p">,</span><span class="n">target</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">ds_idx</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span><span class="n">target</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

