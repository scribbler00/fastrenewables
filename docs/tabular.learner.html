---

title: tabular.learner

keywords: fastai
sidebar: home_sidebar

summary: "API details."
description: "API details."
nb_path: "nbs/04_tabular.learner.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/04_tabular.learner.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">long</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>int</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="RenewableLearner" class="doc_header"><code>class</code> <code>RenewableLearner</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/learner.py#L19" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>RenewableLearner</code>(<strong><code>dls</code></strong>, <strong><code>model</code></strong>, <strong><code>loss_func</code></strong>=<em><code>None</code></em>, <strong><code>opt_func</code></strong>=<em><code>'Adam'</code></em>, <strong><code>lr</code></strong>=<em><code>0.001</code></em>, <strong><code>splitter</code></strong>=<em><code>'trainable_params'</code></em>, <strong><code>cbs</code></strong>=<em><code>None</code></em>, <strong><code>metrics</code></strong>=<em><code>None</code></em>, <strong><code>path</code></strong>=<em><code>None</code></em>, <strong><code>model_dir</code></strong>=<em><code>'models'</code></em>, <strong><code>wd</code></strong>=<em><code>None</code></em>, <strong><code>wd_bn_bias</code></strong>=<em><code>False</code></em>, <strong><code>train_bn</code></strong>=<em><code>True</code></em>, <strong><code>moms</code></strong>=<em><code>(0.95, 0.85, 0.95)</code></em>) :: <code>Learner</code></p>
</blockquote>
<p><code>Learner</code> for renewable data.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_dls</span><span class="p">(</span><span class="n">cat_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;TaskID&#39;</span><span class="p">,</span> <span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="s1">&#39;Day&#39;</span><span class="p">,</span> <span class="s1">&#39;Hour&#39;</span><span class="p">]):</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">chained_assignment</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">cont_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;T_HAG_2_M&#39;</span><span class="p">,</span> <span class="s1">&#39;RELHUM_HAG_2_M&#39;</span><span class="p">,</span> <span class="s1">&#39;PS_SFC_0_M&#39;</span><span class="p">,</span> <span class="s1">&#39;ASWDIFDS_SFC_0_M&#39;</span><span class="p">,</span>
           <span class="s1">&#39;ASWDIRS_SFC_0_M&#39;</span><span class="p">,</span> <span class="s1">&#39;WindSpeed58m&#39;</span><span class="p">]</span>
    <span class="n">dls</span> <span class="o">=</span> <span class="n">RenewableDataLoaders</span><span class="o">.</span><span class="n">from_files</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;../data/*.h5&quot;</span><span class="p">),</span> <span class="n">y_names</span><span class="o">=</span><span class="s2">&quot;PowerGeneration&quot;</span><span class="p">,</span> 
                                          <span class="n">pre_procs</span><span class="o">=</span><span class="p">[</span><span class="n">FilterYear</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2020</span><span class="p">),</span> 
                                                     <span class="n">AddSeasonalFeatures</span><span class="p">(</span><span class="n">as_cont</span><span class="o">=</span><span class="kc">False</span><span class="p">)],</span> 
                                          <span class="n">cat_names</span><span class="o">=</span><span class="n">cat_names</span><span class="p">,</span> <span class="n">cont_names</span><span class="o">=</span><span class="n">cont_names</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dls</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="renewable_learner" class="doc_header"><code>renewable_learner</code><a href="https://github.com/scribbler00/fastrenewables/tree/master/fastrenewables/tabular/learner.py#L54" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>renewable_learner</code>(<strong><code>dls</code></strong>, <strong><code>layers</code></strong>=<em><code>None</code></em>, <strong><code>emb_szs</code></strong>=<em><code>None</code></em>, <strong><code>config</code></strong>=<em><code>None</code></em>, <strong><code>n_out</code></strong>=<em><code>None</code></em>, <strong><code>y_range</code></strong>=<em><code>None</code></em>, <strong><code>embedding_type</code></strong>=<em><code>EmbeddingType.Normal</code></em>, <strong><code>loss_func</code></strong>=<em><code>None</code></em>, <strong><code>opt_func</code></strong>=<em><code>'Adam'</code></em>, <strong><code>lr</code></strong>=<em><code>0.001</code></em>, <strong><code>splitter</code></strong>=<em><code>'trainable_params'</code></em>, <strong><code>cbs</code></strong>=<em><code>None</code></em>, <strong><code>metrics</code></strong>=<em><code>None</code></em>, <strong><code>path</code></strong>=<em><code>None</code></em>, <strong><code>model_dir</code></strong>=<em><code>'models'</code></em>, <strong><code>wd</code></strong>=<em><code>None</code></em>, <strong><code>wd_bn_bias</code></strong>=<em><code>False</code></em>, <strong><code>train_bn</code></strong>=<em><code>True</code></em>, <strong><code>moms</code></strong>=<em><code>(0.95, 0.85, 0.95)</code></em>)</p>
</blockquote>
<p>Get a <code>Learner</code> using <code>dls</code>, with <a href="/fastrenewables/metrics"><code>metrics</code></a>, including a <code>RenewableModel</code> created using the remaining params.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span> <span class="o">=</span> <span class="n">get_dls</span><span class="p">()</span>
<span class="n">learn</span> <span class="o">=</span> <span class="n">renewable_learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">rmse</span><span class="p">)</span>
<span class="n">learn</span><span class="o">.</span><span class="n">model</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>MultiLayerPerceptron(
  (embedding_module): EmbeddingModule(
    (embeddings): ModuleList(
      (0): Embedding(4, 3)
      (1): Embedding(13, 7)
      (2): Embedding(32, 11)
      (3): Embedding(25, 10)
    )
    (emb_drop): Dropout(p=0.1, inplace=False)
  )
  (final_activation): Identity()
  (embeds): ModuleList()
  (emb_drop): Dropout(p=0.0, inplace=False)
  (bn_cont): BatchNorm1d(6, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  (layers): Sequential(
    (0): LinBnDrop(
      (0): Linear(in_features=37, out_features=200, bias=False)
      (1): ReLU(inplace=True)
      (2): BatchNorm1d(200, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    )
    (1): LinBnDrop(
      (0): Linear(in_features=200, out_features=100, bias=False)
      (1): ReLU(inplace=True)
      (2): BatchNorm1d(100, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    )
    (2): LinBnDrop(
      (0): Linear(in_features=100, out_features=1, bias=True)
    )
  )
)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span><span class="o">.</span><span class="n">show_batch</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TaskID</th>
      <th>Month</th>
      <th>Day</th>
      <th>Hour</th>
      <th>T_HAG_2_M</th>
      <th>RELHUM_HAG_2_M</th>
      <th>PS_SFC_0_M</th>
      <th>ASWDIFDS_SFC_0_M</th>
      <th>ASWDIRS_SFC_0_M</th>
      <th>WindSpeed58m</th>
      <th>PowerGeneration</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>7</td>
      <td>19</td>
      <td>22</td>
      <td>290.148</td>
      <td>82.086000</td>
      <td>97923.366998</td>
      <td>95.317001</td>
      <td>195.140998</td>
      <td>2.931393</td>
      <td>0.001</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
      <td>7</td>
      <td>16</td>
      <td>276.949</td>
      <td>89.149000</td>
      <td>99262.804947</td>
      <td>12.376998</td>
      <td>0.999996</td>
      <td>7.277998</td>
      <td>0.280</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>8</td>
      <td>27</td>
      <td>1</td>
      <td>292.829</td>
      <td>92.932000</td>
      <td>100363.035005</td>
      <td>65.152000</td>
      <td>155.571002</td>
      <td>0.466010</td>
      <td>0.001</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>12</td>
      <td>16</td>
      <td>10</td>
      <td>278.566</td>
      <td>91.999000</td>
      <td>92650.331999</td>
      <td>26.373000</td>
      <td>12.141000</td>
      <td>2.139066</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2</td>
      <td>2</td>
      <td>10</td>
      <td>9</td>
      <td>277.865</td>
      <td>72.486000</td>
      <td>92236.676006</td>
      <td>35.745000</td>
      <td>42.988002</td>
      <td>12.481517</td>
      <td>0.562</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0</td>
      <td>10</td>
      <td>6</td>
      <td>23</td>
      <td>281.819</td>
      <td>86.847000</td>
      <td>99886.398003</td>
      <td>40.867000</td>
      <td>14.288001</td>
      <td>6.306612</td>
      <td>0.067</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1</td>
      <td>7</td>
      <td>4</td>
      <td>8</td>
      <td>289.397</td>
      <td>53.923001</td>
      <td>98921.426012</td>
      <td>64.815000</td>
      <td>229.526001</td>
      <td>2.135317</td>
      <td>0.002</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0</td>
      <td>4</td>
      <td>9</td>
      <td>21</td>
      <td>283.620</td>
      <td>83.940000</td>
      <td>99787.561986</td>
      <td>84.202000</td>
      <td>43.011000</td>
      <td>3.709068</td>
      <td>0.346</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1</td>
      <td>4</td>
      <td>4</td>
      <td>17</td>
      <td>278.001</td>
      <td>86.131000</td>
      <td>96511.805033</td>
      <td>60.881000</td>
      <td>5.545002</td>
      <td>6.923151</td>
      <td>0.028</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2</td>
      <td>9</td>
      <td>23</td>
      <td>2</td>
      <td>285.771</td>
      <td>89.472000</td>
      <td>93088.508006</td>
      <td>77.973000</td>
      <td>60.520000</td>
      <td>7.848964</td>
      <td>0.008</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>_rmse</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.017542</td>
      <td>0.013439</td>
      <td>0.115928</td>
      <td>00:02</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n_conts</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dls</span><span class="o">.</span><span class="n">cont_names</span><span class="p">)</span>
<span class="n">hidden_layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_conts</span><span class="p">]</span> <span class="o">+</span> <span class="n">get_structure</span><span class="p">(</span><span class="n">n_conts</span><span class="o">*</span><span class="mi">20</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">learn</span> <span class="o">=</span> <span class="n">renewable_learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">rmse</span><span class="p">,</span> <span class="n">layers</span><span class="o">=</span><span class="n">hidden_layers</span><span class="p">,</span> <span class="n">embedding_type</span><span class="o">=</span><span class="n">EmbeddingType</span><span class="o">.</span><span class="n">Bayes</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>MultiLayerPerceptron (Input shape: 64 x torch.Size([64, 6]))
============================================================================
Layer (type)         Output Shape         Param #    Trainable 
============================================================================
                     64 x 3              
Embedding                                 12         True      
____________________________________________________________________________
                     64 x 7              
Embedding                                 91         True      
____________________________________________________________________________
                     64 x 11             
Embedding                                 352        True      
____________________________________________________________________________
                     64 x 10             
Embedding                                 250        True      
Dropout                                                        
Identity                                                       
BatchNorm1d                               12         True      
____________________________________________________________________________
                     64 x 120            
Linear                                    4440       True      
ReLU                                                           
BatchNorm1d                               240        True      
____________________________________________________________________________
                     64 x 12             
Linear                                    1440       True      
ReLU                                                           
BatchNorm1d                               24         True      
____________________________________________________________________________
                     64 x 10             
Linear                                    120        True      
ReLU                                                           
BatchNorm1d                               20         True      
____________________________________________________________________________
                     64 x 1              
Linear                                    11         True      
____________________________________________________________________________

Total params: 7,012
Total trainable params: 7,012
Total non-trainable params: 0

Optimizer used: &lt;function Adam at 0x7fe032a23ee0&gt;
Loss function: VILoss(
  (base_loss):FlattenedLoss of MSELoss()
  (kl_weight): 0.1 
)

Callbacks:
  - TrainEvalCallback
  - Recorder
  - ProgressCallback</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>_rmse</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.247948</td>
      <td>1.011070</td>
      <td>0.125699</td>
      <td>00:02</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preds</span><span class="p">,</span><span class="n">target</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">ds_idx</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span><span class="n">target</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-5-18dcf2e4b236&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-green-fg">import</span> matplotlib<span class="ansi-blue-fg">.</span>pyplot <span class="ansi-green-fg">as</span> plt
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>plt<span class="ansi-blue-fg">.</span>scatter<span class="ansi-blue-fg">(</span>preds<span class="ansi-blue-fg">,</span>target<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;preds&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

