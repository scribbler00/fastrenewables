---

title: baselines


keywords: fastai
sidebar: home_sidebar

summary: "API details."
description: "API details."
nb_path: "nbs/00d_baselines.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/00d_baselines.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/home/scribbler/anaconda/envs/dies/lib/python3.8/site-packages/numba/np/ufunc/parallel.py:363: NumbaWarning: <span class="ansi-bold">The TBB threading layer requires TBB version 2019.5 or later i.e., TBB_INTERFACE_VERSION &gt;= 11005. Found TBB_INTERFACE_VERSION = 9107. The TBB threading layer is disabled.</span>
  warnings.warn(problem)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_test_data</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="n">n_samples</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mf">0.1</span><span class="o">+</span><span class="mi">1</span>
    
    <span class="k">return</span> <span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">y</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">get_test_data</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.collections.PathCollection at 0x7f755d871370&gt;</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">_append_one_col</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;append array with ones in order to replace a fitted bias in the output&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">X</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">BayesLinReg</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Batch wise linear regression&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_features</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># inspired by https://maxhalford.github.io/blog/bayesian-linear-regression/</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>

        <span class="c1"># If x and y are singletons, then we coerce them to a batch of length 1</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="n">X</span> <span class="o">=</span> <span class="n">_append_one_col</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cov_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>

        <span class="c1"># Update the inverse covariance matrix (Bishop eq. 3.51)</span>
        <span class="n">cov_inv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov_inv</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">*</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">X</span>

        <span class="c1"># Update the mean vector (Bishop eq. 3.50)</span>
        <span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">cov_inv</span><span class="p">)</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">cov</span> <span class="o">@</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cov_inv</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">*</span> <span class="n">y</span> <span class="o">@</span> <span class="n">X</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cov_inv</span> <span class="o">=</span> <span class="n">cov_inv</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="n">mean</span>

        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="n">X</span> <span class="o">=</span> <span class="n">_append_one_col</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="c1"># Obtain the predictive mean (Bishop eq. 3.58)</span>
        <span class="n">y_pred_mean</span> <span class="o">=</span> <span class="n">X</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span>

        <span class="c1"># Obtain the predictive variance (Bishop eq. 3.59)</span>
        <span class="n">w_cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cov_inv</span><span class="p">)</span>
        <span class="n">y_pred_var</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">+</span> <span class="p">(</span><span class="n">X</span> <span class="o">@</span> <span class="n">w_cov</span> <span class="o">*</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Drop a dimension from the mean and variance in case x and y were singletons</span>
        <span class="c1"># There might be a more elegant way to proceed but this works!</span>
        <span class="n">y_pred_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">y_pred_mean</span><span class="p">)</span>
        <span class="n">y_pred_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">y_pred_var</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">y_pred_mean</span><span class="p">,</span> <span class="n">y_pred_var</span> <span class="o">**</span> <span class="mf">0.5</span>
        

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>

        <span class="n">y_pred_mean</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">y_pred_mean</span>
    
    <span class="k">def</span> <span class="nf">predict_proba</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>

        <span class="n">y_pred_mean</span><span class="p">,</span> <span class="n">y_pred_std</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="c1"># return stats.norm(loc=y_pred_mean, scale=y_pred_var ** .5)</span>
        <span class="k">return</span> <span class="n">y_pred_mean</span><span class="p">,</span> <span class="n">y_pred_std</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>((20, 1), (20,))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">get_test_data</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">BayesLinReg</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># test data</span>
<span class="n">X</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">get_test_data</span><span class="p">()</span>
<span class="n">yhat</span><span class="p">,</span> <span class="n">ystd</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">yhat</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Pred&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">yhat</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Pred&quot;</span><span class="p">)</span>

<span class="n">x_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">yhat</span><span class="p">,</span> <span class="n">ystd</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">x_range</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_range</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">yhat</span><span class="o">-</span><span class="n">ystd</span><span class="p">),</span> <span class="p">(</span><span class="n">yhat</span><span class="o">+</span><span class="n">ystd</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.legend.Legend at 0x7f755d781400&gt;</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">RidgeRegression</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l2_reg</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l2_reg</span> <span class="o">=</span> <span class="n">l2_reg</span>

    <span class="k">def</span> <span class="nf">_ridge_regression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;ridge / tikhonov regularized linear multiple, multivariate regression&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">X</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">l2_reg</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">@</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">y</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">_append_one_col</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ridge_regression</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">_append_one_col</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">y_hat</span> <span class="o">=</span> <span class="n">X</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span>

        <span class="k">return</span> <span class="n">y_hat</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">relu</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">identity</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ELM</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n_hidden</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">activations</span><span class="o">=</span><span class="n">relu</span><span class="p">,</span> <span class="n">prediction_model</span><span class="o">=</span><span class="n">BayesLinReg</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;[summary]</span>

<span class="sd">        Args:</span>
<span class="sd">            n_hidden (int, optional): [description]. Defaults to 100.</span>
<span class="sd">            activations ([type], optional): [description]. Defaults to relu.</span>
<span class="sd">            prediction_model_type (str, optional): [description]. Defaults to &quot;ridge&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prediction_model</span> <span class="o">=</span> <span class="n">prediction_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_hidden</span> <span class="o">=</span> <span class="n">n_hidden</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activations</span> <span class="o">=</span> <span class="n">activations</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prediction_model</span> <span class="o">=</span> <span class="n">BayesLinReg</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prediction_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_model</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">ELM</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_as_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">a</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>
        
    <span class="k">def</span> <span class="nf">transform_X</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">activations</span><span class="p">):</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span>
        <span class="n">Hs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">activations</span><span class="p">:</span>
            <span class="n">Hs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">Hs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>

        <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_data</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">multi_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_n_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hidden_weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_hidden</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_biases</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_hidden</span><span class="p">])</span>

        
        <span class="n">X_transformed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_X</span><span class="p">(</span>
            <span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hidden_weights</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_biases</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_as_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">activations</span><span class="p">)</span>
        <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_prediction_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_transformed</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">_prep_pred_X</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
         <span class="c1"># Check is fit had been called</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_data</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="n">X_transformed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_X</span><span class="p">(</span>
            <span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hidden_weights</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_biases</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_as_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">activations</span><span class="p">)</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">X_transformed</span>
        

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">X_transformed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_pred_X</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">y_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prediction_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_transformed</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">y_hat</span>
    
    <span class="k">def</span> <span class="nf">predict_proba</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">X_transformed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_pred_X</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prediction_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_transformed</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">local_param_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">local_params</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">local_param_keys</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">local_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="c1"># assume that remaining keys must be part of the prediction model</span>
        <span class="n">non_local_params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">local_param_keys</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prediction_model</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">non_local_params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">get_test_data</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ELM</span><span class="p">(</span><span class="n">n_hidden</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">activations</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">],</span> <span class="n">prediction_model</span><span class="o">=</span><span class="n">BayesLinReg</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;TrueTrain&quot;</span><span class="p">)</span>

<span class="c1"># test data</span>
<span class="n">X</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">get_test_data</span><span class="p">()</span>
<span class="n">yhat</span><span class="p">,</span> <span class="n">ystd</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>


<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;TrueTest&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">yhat</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Pred&quot;</span><span class="p">)</span>

<span class="n">x_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">yhat</span><span class="p">,</span> <span class="n">ystd</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">x_range</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_range</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">yhat</span><span class="o">-</span><span class="mf">1.96</span><span class="o">*</span><span class="n">ystd</span><span class="p">),</span> <span class="p">(</span><span class="n">yhat</span><span class="o">+</span><span class="mf">1.96</span><span class="o">*</span><span class="n">ystd</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;CI&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.legend.Legend at 0x7f755d75ae20&gt;</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">EchoStateRegression</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">num_hidden</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">activations</span><span class="o">=</span><span class="p">[</span><span class="n">relu</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">,</span> <span class="n">identity</span><span class="p">],</span>
        <span class="n">activation_momentum</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
        <span class="n">prediction_model</span><span class="o">=</span><span class="n">RidgeRegression</span><span class="p">(),</span>
    <span class="p">):</span>
        <span class="c1"># number of input features (necessary for initialization)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_in_feature</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># number of hidden recurrent units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_hidden</span> <span class="o">=</span> <span class="n">num_hidden</span>
        <span class="c1"># squashing / activation function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activations</span> <span class="o">=</span> <span class="n">activations</span>
        <span class="c1"># activation momentum: each recurrent activation is a moving average of the past</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activation_momentum</span> <span class="o">=</span> <span class="n">activation_momentum</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prediction_model</span> <span class="o">=</span> <span class="n">prediction_model</span>

    <span class="k">def</span> <span class="nf">_init_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;randomly initialize parameters&quot;&quot;&quot;</span>
        <span class="c1"># initalize input weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W_in</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_in_feature</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_hidden</span><span class="p">)</span>
            <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_hidden</span><span class="p">)</span>
            <span class="o">-</span> <span class="mf">0.5</span>
        <span class="p">)</span>
        <span class="c1"># initialize recurrent weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W_rec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_hidden</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_hidden</span><span class="p">)</span>
        <span class="c1"># compute spectral radius from recurrent weights</span>
        <span class="n">spectral_radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_rec</span><span class="p">)))</span>
        <span class="c1"># normalize recurrent weights via the spectral radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W_rec</span> <span class="o">/=</span> <span class="n">spectral_radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># biases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_hidden</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_run_reservoir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fcompute reservoir activations of the echo state network&quot;&quot;&quot;</span>
        <span class="c1"># get number of sequences</span>
        <span class="n">num_sequences</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># get number of time steps (assumed to be equal, e.g. by padding)</span>
        <span class="n">num_time_steps</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># compute the matrix product between each input sequence element and</span>
        <span class="c1"># the input weight matrix (einsum replaces a loop over time steps)</span>
        <span class="n">H_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ijk,kl&quot;</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_in</span><span class="p">)</span>

        <span class="n">H_recs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># initialize recurrent activation with zeros</span>
        <span class="k">for</span> <span class="n">act_func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">activations</span><span class="p">:</span>
            <span class="n">H_rec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_sequences</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_hidden</span><span class="p">))</span>
            <span class="c1"># loop all time steps</span>
            <span class="k">for</span> <span class="n">time_step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_time_steps</span><span class="p">):</span>
                <span class="c1"># compute recurrent input from previous time step recurrent activation</span>
                <span class="n">rec</span> <span class="o">=</span> <span class="n">H_rec</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_rec</span>
                <span class="c1"># comput hidden recurrent activation for next time step</span>
                <span class="n">H_rec</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation_momentum</span><span class="p">)</span> <span class="o">*</span> <span class="n">act_func</span><span class="p">(</span>
                    <span class="n">H_in</span><span class="p">[:,</span> <span class="n">time_step</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">rec</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span>
                <span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation_momentum</span> <span class="o">*</span> <span class="n">H_rec</span>
            <span class="n">H_recs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">H_rec</span><span class="p">)</span>

        <span class="n">H_rec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">H_recs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># return final activation for the last time step</span>
        <span class="k">return</span> <span class="n">H_rec</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fitting a echo state network with a single time step forecast horizon.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_in_feature</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_in_feature</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init_params</span><span class="p">()</span>
        <span class="c1"># compute reservoir activations</span>
        <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_reservoir</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prediction_model</span> <span class="o">=</span> <span class="n">MultiOutputRegressor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prediction_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prediction_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Predicting the trained echo state network&quot;&quot;&quot;</span>
        <span class="c1"># assert that number of input features was correct</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_in_feature</span> <span class="o">==</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="c1"># compute reservoir activations</span>
        <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_reservoir</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="c1"># append array with ones in order to replace a fitted bias in the output</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">RocketReservoirRegression</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">num_kernels</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">prediction_model</span><span class="o">=</span><span class="n">RidgeRegression</span><span class="p">(),</span> <span class="n">normalise</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_kernels</span> <span class="o">=</span> <span class="n">num_kernels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prediction_model</span> <span class="o">=</span> <span class="n">prediction_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rocket</span> <span class="o">=</span> <span class="n">Rocket</span><span class="p">(</span><span class="n">num_kernels</span><span class="o">=</span><span class="n">num_kernels</span><span class="p">,</span> <span class="n">normalise</span><span class="o">=</span><span class="n">normalise</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;expects array of dimensions num_samples X timesteps X num features&quot;&quot;&quot;</span>
        <span class="n">X_transformed</span> <span class="o">=</span> <span class="n">from_3d_numpy_to_nested</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">X_transformed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rocket</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_transformed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prediction_model</span> <span class="o">=</span> <span class="n">MultiOutputRegressor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prediction_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prediction_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_transformed</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">X_transformed</span> <span class="o">=</span> <span class="n">from_3d_numpy_to_nested</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">X_transformed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rocket</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_transformed</span><span class="p">)</span>

        <span class="n">yhat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_transformed</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">yhat</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

